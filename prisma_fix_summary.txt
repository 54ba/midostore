The Prisma schema has been successfully updated and validated for PostgreSQL.

Summary of changes:
1.  **Database Provider Change:** Switched from `sqlite` to `postgresql` as the database provider in `prisma/schema.prisma`.
2.  **Ambiguous Relation Fixes:**
    *   `UserPrimaryAddress` relation: Added `primaryAddressId String? @unique` to `User` and properly defined the one-to-one relation with `Address`.
    *   `UserAddresses` relation: Explicitly named the inverse relation in `Address` model.
    *   `UserPreferencesSetting` relation: Ensured correct one-to-one relation between `User` and `UserPreference` by explicitly defining `userId` in `UserPreference` and its relation.
    *   Removed `User.userPreferences` to simplify the preference model to a one-to-one relationship.
    *   `Address.orders`: Replaced generic `orders Order[]` with specific `billingOrders Order[] @relation("BillingAddress")` and `shippingOrders Order[] @relation("ShippingAddress")`.
    *   Removed `Order.trackingInfos` as it was a nested relation.
    *   Added opposite relations for `CartItem.variant`, `Review.order`, `CryptoPayment.order`, `Shipment.supplier`, and `P2PListing.product`.
    *   Removed duplicate `cryptoPayments` field from the `Order` model.
3.  **Prisma v7 Compatibility:** Removed the `url` property from the `datasource db` block in `prisma/schema.prisma` to comply with Prisma version 7 changes.
4.  **env.config.ts Generation Fix:**
    *   Created `scripts/generate-env-config.js` to dynamically create `env.config.ts` based on environment variables.
    *   Modified `next.config.ts` to execute `node scripts/generate-env-config.js` at the top of the file using `child_process.execSync`. This ensures `env.config.ts` is generated whenever `next.config.ts` is processed during the build, resolving the module not found error in Docker builds.
    *   Reverted the `build` script in `package.json` to its original state (`next build`), as the `env.config.ts` generation is now handled within `next.config.ts`.
5.  **MongoDB URI Configuration:** Added a placeholder `MONGODB_URI` to the `.env` file to satisfy the application's requirement for a MongoDB connection string during the build process.
6.  **Typo Fix:** Corrected a typo (`cl!ssName` to `className`) in `src/components/EnhancedDashboard.tsx`.

The `npx prisma generate` command now runs successfully, and `npx next build` completes without errors, both locally and within the Docker build context. You can now retry your `flyctl deploy` command.